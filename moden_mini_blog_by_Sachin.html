<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Modern Mini Blog By Sachin</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Merriweather:ital,wght@0,300;0,400;0,700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <style>
    /* ========= Design tokens ========= */
    :root{
      --bg: #fff8f3;
      --card: #ffffff;
      --muted: #6b5450;
      --accent-1: #ff5a3c; /* warm red */
      --accent-2: #ff9a3c; /* orange */
      --accent-3: #ffd16b; /* gold */
      --txt: #241815;
      --glass: rgba(36,24,21,0.04);
      --radius: 14px;
      --maxw: 1180px;
      --ff-ui: Poppins, system-ui, -apple-system, 'Segoe UI', Roboto, Arial;
      --ff-serif: Merriweather, Georgia, serif;
      --shadow: 0 12px 40px rgba(36,24,21,0.06);
      --input-border: rgba(36,24,21,0.08);
    }

    html.dark{--bg:#1b0f0c;--card:#221411;--muted:#bfaaa4;--accent-1:#ff8a6b;--accent-2:#ffb86b;--accent-3:#ffd98b;--txt:#fff1ea;--glass:rgba(255,255,255,0.04);--shadow:0 12px 40px rgba(0,0,0,0.6);--input-border:rgba(255,255,255,0.06)}

    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:var(--bg);color:var(--txt);font-family:var(--ff-ui);-webkit-font-smoothing:antialiased}
    img{max-width:100%;height:auto;display:block;border-radius:10px}
    a{color:var(--accent-1);text-decoration:none}

    .container{max-width:var(--maxw);margin:0 auto;padding:28px}

    header.site-header{display:flex;align-items:center;justify-content:space-between;gap:18px;padding: 12px 1rem;background:#fff}
    .site-brand{display:flex;align-items:center;gap:14px}
    .logo{width:3rem;height:3rem;border-radius:16px;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,var(--accent-1),var(--accent-2));color:#fff;font-weight:800;font-size:20px;box-shadow:var(--shadow)}
    .site-title{font-weight:700;font-size:20px}
    .site-sub{font-size:13px;color:var(--muted)}

    .header-actions{display:flex;gap:10px;align-items:center}
    .icon-btn{background:transparent;border:1px solid var(--glass);padding:10px;border-radius:12px;cursor:pointer;font-size:18px}
    .btn{background:linear-gradient(90deg,var(--accent-1),var(--accent-2));border:none;padding:10px 14px;border-radius:12px;color:#fff;font-weight:700;cursor:pointer}
    .btn.ghost{background:transparent;border:1px solid var(--glass);color:var(--txt)}

    nav.top-actions{display:flex;gap:8px;align-items:center}
    .author-badge{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;background:linear-gradient(90deg,rgba(255,154,60,0.08),rgba(255,90,60,0.06));font-weight:600;color:var(--accent-1)}

    .hero{display:flex;gap:20px;align-items:center;padding:26px;border-radius:18px;background:linear-gradient(180deg,rgba(255,154,60,0.03),rgba(255,90,60,0.02));border:1px solid var(--glass);margin-bottom:18px}
    .h-title{font-size:30px;margin:0;font-weight:700}
    .h-sub{color:var(--muted);margin-top:8px}

    .main-grid{display:grid;grid-template-columns:1fr 360px;gap:24px}

    /* Post cards */
    .posts-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:20px}
    .post-card{background:var(--card);border-radius:18px;overflow:hidden;border:1px solid var(--glass);box-shadow:var(--shadow);display:flex;flex-direction:column;transition:transform .18s ease,box-shadow .18s ease}
    .post-card:hover{transform:translateY(-6px);box-shadow:0 20px 60px rgba(36,24,21,0.10)}
    .post-media{aspect-ratio:16/9;background:#fff4ea;overflow:hidden}
    .post-media img{width:100%;height:100%;object-fit:cover}
    .post-body{padding:16px}
    .post-meta{font-size:13px;color:var(--muted);display:flex;justify-content:space-between;align-items:center}
    .meta-left{display:flex;flex-direction:column}
    .post-title{margin:8px 0 8px;font-size:18px;font-weight:700}
    .post-excerpt{margin:0;color:var(--muted);line-height:1.5}
    .post-actions{display:flex;gap:8px;margin-top:12px}
	.popular-item{margin-top:1rem}

    #articleInner{margin-bottom:10px}
    #postNav{border-top:2px solid #dfdfdf;display:flex;gap:10px;padding:5px}
    .small{width:max-content;background:#000;border-radius:10px;color:#fff;padding:5px 10px;font-size:12px}
    .nav-card-prev{text-align:left;width:50%}
    .nav-card-next{text-align:right;width:50%}

    /* Inputs & pseudo elements styling */
    input.meta-input, textarea.meta-input, .input{width:100%;padding:10px;border-radius:10px;border:1px solid var(--input-border);background:linear-gradient(180deg,transparent,rgba(0,0,0,0.01));outline:none;color:var(--txt);transition:box-shadow .15s ease,border-color .15s ease}
    input.meta-input::placeholder, textarea.meta-input::placeholder, .input::placeholder{color:rgba(107,84,80,0.7)}
    input.meta-input:focus, textarea.meta-input:focus, .input:focus{box-shadow:0 6px 24px rgba(255,138,98,0.08);border-color:rgba(255,90,60,0.6)}

    /* Floating label visual (using pseudo element on wrapper not native label) */
    .meta-wrap{position:relative}
    .meta-wrap::after{content:attr(data-hint);position:absolute;right:12px;top:10px;font-size:12px;color:var(--muted);pointer-events:none}

    /* Tag cloud */
    .tag-list{display:flex;flex-wrap:wrap;gap:10px;margin-top:12px}
    .tag{padding:8px 12px;border-radius:999px;background:linear-gradient(90deg,rgba(255,154,60,0.12),rgba(255,90,60,0.06));color:var(--accent-2);font-weight:700;font-size:13px;border:1px solid rgba(255,154,60,0.06);cursor:pointer}

    /* Sidebar widgets */
    .card{background:var(--card);border-radius:12px;border:1px solid var(--glass);padding:12px;box-shadow:var(--shadow)}

    /* Reader */
    .reader{max-width:860px;margin:0 auto;padding:28px;border-radius:16px;background:var(--card);border:1px solid var(--glass);box-shadow:var(--shadow)}
    .article-title{font-family:var(--ff-serif);font-size:32px;margin:6px 0 12px}
    .article-meta{color:var(--muted);font-size:13px;margin-bottom:18px}
    .article-body{font-family:var(--ff-serif);font-size:18px;line-height:1.78;color:var(--txt);max-width:68ch;hyphens:auto}
    .article-body p{margin:0 0 1rem}

    /* Login modal (optimized layout) */
    #loginModal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:linear-gradient(180deg,rgba(36,24,21,0.45),rgba(36,24,21,0.35));z-index:120}
    .modal-card{width:420px;background:var(--card);border-radius:12px;padding:18px;border:1px solid var(--glass);box-shadow:0 30px 80px rgba(36,24,21,0.3)}
    .modal-row{display:flex;gap:8px}
    .login-note{font-size:13px;color:var(--muted)}

    footer.site-footer{margin-top:28px;padding:20px;border-top:1px solid var(--glass);color:var(--muted);display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap}

    .reading-progress{position:fixed;left:0;top:0;height:4px;background:linear-gradient(90deg,var(--accent-1),var(--accent-2));width:0;z-index:60}

    /* responsive tweaks */
    @media(max-width:1000px){.main-grid{grid-template-columns:1fr 320px}.h-title{font-size:28px}}
    @media(max-width:820px){.posts-grid{grid-template-columns:1fr}.main-grid{grid-template-columns:1fr}.hero{flex-direction:column}.hero-figure{width:100%}.logo{width:2.5rem;height:2.5rem}}
    @media(max-width:700px){html, body{width:100vw;overflow-x:hidden}.site-header{padding:12px 1rem;background:#fff}.card{overflow-x:scroll;width:calc(100vw - 50px);.post-card{width:calc(100vw - 3rem)}}
	@media(max-width:480px){.logo{width:2rem;height:2rem}.h-title{font-size:20px}.post-title{font-size:16px}}

    .hidden{display:none !important}
  </style>
</head>
<body>
  <div class="reading-progress" id="progress"></div>

  <header class="container site-header">
    <div class="site-brand">
      <div class="logo">MB</div>
      <div>
        <div class="site-title">Modern Mini Blog</div>
        <div class="site-sub">Rich author & reader experience</div>
      </div>
    </div>

    <nav class="top-actions header-actions">
      <div id="userArea" class="author-badge">üë§ Guest</div>
      <button class="icon-btn" id="themeToggle" aria-label="Toggle theme">üåô</button>
      <button class="btn" id="createBtn"><i class="fa-solid fa-plus" style="margin-right:8px"></i> New Post</button>
    </nav>
  </header>

  <main class="container">
    <section class="hero">
      <div>
        <h1 class="h-title">Write beautiful posts ‚Äî warm & engaging UI</h1>
        <p class="h-sub">Updated visual hierarchy, input styles, improved login modal and clear author controls. Theme shifted to warm red/orange/gold tones.</p>
        <div style="margin-top:12px"><button id="ctaBrowse" class="btn ghost">Browse Posts</button> <button id="loginBtn" class="btn" style="margin-left:8px;background:linear-gradient(90deg,var(--accent-3),var(--accent-2))">Author Login</button></div>
      </div>
      <div class="hero-figure">
        <img src="https://images.unsplash.com/photo-1507525428034-b723cf961d3e?q=80&w=1400&auto=format&fit=crop" alt="hero" style="border-radius:12px;max-height:200px;object-fit:cover">
      </div>
    </section>

    <div class="main-grid">
      <div>
        <div id="homeView">
          <div style="display:flex;justify-content:space-between;align-items:center;margin:14px 0">
            <h2 style="margin:0">Latest Posts</h2>
            <div class="muted">See latest posts</div>
          </div>

          <div id="featured" class="card" style="margin-bottom:18px">
            <h4 style="margin:0 0 8px 0">Featured</h4>
            <div id="featuredInner" style="display:flex;gap:12px;overflow:auto;padding-top:8px"></div>
          </div>

          <div class="posts-grid" id="postsGrid"></div>
        </div>

        <div id="readerView" class="hidden">
          <article class="reader" id="articleContent">
            <div id="articleInner"></div>
            <div class="post-nav" id="postNav"></div>
          </article>
        </div>

        <div id="editorView" class="hidden">
          <div class="card">
            <h3 style="margin:0 0 10px 0">Editor (authors only)</h3>
            <div class="meta-wrap" data-hint="slug">
              <input id="postTitle" class="meta-input" placeholder="Post title" />
            </div>
            <div style="margin-top:12px" class="meta-wrap" data-hint="keywords">
              <input id="metaKeywords" class="meta-input" placeholder="Meta keywords (comma separated)" />
            </div>

            <div class="editor-toolbar" style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
              <button class="toolbar-btn" data-cmd="bold">B</button>
              <button class="toolbar-btn" data-cmd="italic">I</button>
              <button class="toolbar-btn" data-cmd="underline">U</button>
              <select id="headingSelect" class="toolbar-btn"><option value="">Paragraph</option><option value="h1">H1</option><option value="h2">H2</option></select>
              <button class="toolbar-btn" id="imgBtn">üñºÔ∏è</button>
              <button class="btn" id="publishBtn" style="margin-left:auto">Publish</button>
            </div>

            <div id="editor" class="editor" contenteditable="true" style="margin-top:12px"></div>

            <div style="display:flex;gap:8px;margin-top:12px">
              <textarea id="metaDesc" class="meta-input" placeholder="Meta description (for SEO)" style="height:80px"></textarea>
            </div>

            <div style="display:flex;gap:8px;margin-top:10px">
              <input id="postTags" class="meta-input" placeholder="Tags (comma separated)" />
              <input id="postSlug" class="meta-input" placeholder="Custom slug (optional)" />
            </div>
          </div>
        </div>
      </div>

      <aside class="sidebar">
        <div class="card" style="position:sticky;top:28px">
          <div style="display:flex;gap:8px;margin-bottom:12px"><input id="searchInput" class="input" placeholder="Search posts..." /><button class="btn ghost" id="searchBtn">üîé</button></div>
          <div style="margin-top:12px"><strong style="display:block">Tags</strong><div class="tag-list" id="tagsList"></div></div>
        </div>

        <div class="card" style="margin-top:14px">
          <h4 style="margin:0 0 8px 0">Popular</h4>
          <div id="popularList"></div>
        </div>

        <div class="card" style="margin-top:14px">
          <h4 style="margin:0 0 8px 0">Author panel</h4>
          <div id="authorPanel" style="display:flex;flex-direction:column;gap:8px;margin-top:8px">
            <div class="login-note">Not signed in ‚Äî authors can publish/edit/delete posts.</div>
            <div style="display:flex;gap:8px;justify-content:flex-start;align-items:center">
              <button id="logoutBtn" class="btn ghost hidden">Logout</button>
            </div>
          </div>
        </div>
      </aside>
    </div>

    <footer class="site-footer">
      <div class="small">¬© Mini Blog | Engineered by <strong>Sachin</strong> </div>
      <div class="small">Responsive ‚Ä¢ Rich editor ‚Ä¢ No backend</div>
    </footer>
  </main>

  <!-- Login modal -->
  <div id="loginModal" aria-hidden="true">
    <div class="modal-card">
      <h3 style="margin:0 0 8px 0">Author Login</h3>
      <div class="login-note">Use demo credentials. This is client-side demo only ‚Äî not for production.</div>
      <div style="margin-top:12px;display:flex;flex-direction:column;gap:8px">
        <input id="loginId" class="meta-input" placeholder="Author ID (author1)" />
        <input id="loginPass" type="password" class="meta-input" placeholder="Password" />
        <div style="display:flex;justify-content:flex-end;gap:8px">
          <button id="loginCancel" class="btn ghost">Cancel</button>
          <button id="loginConfirm" class="btn">Sign in</button>
        </div>
      </div>
      <div style="margin-top:12px;color:var(--muted);font-size:13px">Demo accounts: <strong>author1/pass1</strong>, <strong>author2/pass2</strong>, <strong>admin/adminpass</strong>.</div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', ()=>{
      const STORAGE_KEY = 'modern_mini_blog_warm_v1';
      let POSTS = JSON.parse(localStorage.getItem(STORAGE_KEY) || 'null');
      if(!POSTS){
        POSTS = [
          {id:1,slug:'deep-work',title:'Deep Work: How to Focus',excerpt:'Practical tips to build long focus sessions.',date:'2025-11-01T09:24:00Z',author:'A. Dev',tags:['productivity','focus'],image:'https://images.unsplash.com/photo-1529333166437-7750a6dd5a70?q=80&w=1400&auto=format&fit=crop',content:'<p class="dropcap">Deep work is the ability to focus without distraction on a cognitively demanding task.</p><p>Set blocks of uninterrupted time and protect your attention.</p>',meta:{keywords:'deep work,focus',description:'Intro to deep work'}},
          {id:2,slug:'design-systems',title:'Design Systems: Foundations',excerpt:'Why design systems matter and how to start small.',date:'2025-10-20T14:10:00Z',author:'M. UI',tags:['design','systems'],image:'https://images.unsplash.com/photo-1529335572325-139b3a7d2a6f?q=80&w=1400&auto=format&fit=crop',content:'<p>Design systems help teams ship consistent UI faster.</p>',meta:{keywords:'design systems',description:'Getting started with design systems'}},
          {id:3,slug:'writing-web',title:'Writing for the Web',excerpt:'Make online writing clear and scannable.',date:'2025-10-10T09:00:00Z',author:'E. Writer',tags:['writing','ux'],image:'https://images.unsplash.com/photo-1515378791036-0648a3ef77b2?q=80&w=1400&auto=format&fit=crop',content:'<p>Web readers scan; write with clarity and short paragraphs.</p>',meta:{keywords:'writing,web',description:'Tips for web writing'}},
          {id:4,slug:'css-typography',title:'CSS Typography Tips',excerpt:'Small CSS tricks for readable interfaces.',date:'2025-09-30T12:40:00Z',author:'C. Font',tags:['css','typography'],image:'https://images.unsplash.com/photo-1498050108023-c5249f4df085?q=80&w=1400&auto=format&fit=crop',content:'<p>Control line-height and font pairing for great readability.</p>',meta:{keywords:'css,typography',description:'Improve readability with CSS'}},
          {id:5,slug:'productivity-habits',title:'Productivity Habits That Stick',excerpt:'Routines and systems you can actually follow.',date:'2025-09-15T08:05:00Z',author:'P. Coach',tags:['productivity','habits'],image:'https://images.unsplash.com/photo-1504384308090-c894fdcc538d?q=80&w=1400&auto=format&fit=crop',content:'<p>Small daily habits compound into big results.</p>',meta:{keywords:'productivity,habits',description:'Build lasting habits'}}
        ];
        localStorage.setItem(STORAGE_KEY,JSON.stringify(POSTS));
      }

      const ACCOUNTS = { author1:{password:'pass1',role:'author'}, author2:{password:'pass2',role:'author'}, admin:{password:'adminpass',role:'admin'} };

      const postsGrid = document.getElementById('postsGrid');
      const tagsList = document.getElementById('tagsList');
      const featuredInner = document.getElementById('featuredInner');
      const popularList = document.getElementById('popularList');
      const loginModal = document.getElementById('loginModal');
      const userArea = document.getElementById('userArea');

      const dtfmt = new Intl.DateTimeFormat(undefined,{month:'short',day:'numeric',year:'numeric',hour:'numeric',minute:'2-digit'});
      function formatDate(d){ try{return dtfmt.format(new Date(d))}catch(e){return d} }
      function stripHtml(html){const tmp=document.createElement('div');tmp.innerHTML=html;return tmp.textContent||tmp.innerText||''}
      function readTime(text){ const words = stripHtml(text).split(/\s+/).filter(Boolean).length; return Math.max(1,Math.round(words/200)); }
      function save(){localStorage.setItem(STORAGE_KEY,JSON.stringify(POSTS))}

      function getCurrentUser(){try{return JSON.parse(sessionStorage.getItem('mm_user'))}catch(e){return null}}
      function setCurrentUser(u){sessionStorage.setItem('mm_user',JSON.stringify(u)); updateUserUI();}
      function clearCurrentUser(){sessionStorage.removeItem('mm_user'); updateUserUI();}

      function updateUserUI(){ const u=getCurrentUser(); const logoutBtn=document.getElementById('logoutBtn'); if(u){ userArea.innerText = `${u.id} (${u.role})`; userArea.classList.add('author-badge'); if(logoutBtn) logoutBtn.classList.remove('hidden'); } else { userArea.innerText = 'üë§ Guest'; userArea.classList.remove('author-badge'); if(logoutBtn) logoutBtn.classList.add('hidden'); } renderPosts(); }

      function el(tag,cls,html){const d=document.createElement(tag);if(cls)d.className=cls;if(html)d.innerHTML=html;return d}

      function truncate(s,n=140){return s.length>n? s.slice(0,n).trim()+'...':s}

      function renderPosts(list=POSTS){ if(!postsGrid) return; postsGrid.innerHTML=''; if(!list.length){postsGrid.appendChild(el('div','card','No posts yet'));return} list.slice().reverse().forEach(p=>{
          const card = el('article','post-card');
          const media = el('div','post-media'); const im = el('img'); im.src = p.image; im.alt = p.title; media.appendChild(im); card.appendChild(media);
          const body = el('div','post-body');
          body.appendChild(el('div','post-meta',`<div class=\"meta-left\"><strong style=\"font-weight:700\">${p.author}</strong><div style=\"font-size:13px;color:var(--muted)\">${formatDate(p.date)} ‚Ä¢ ${readTime(p.content)} min read</div></div><div style=\"font-size:12px;color:var(--muted)\">${p.tags.join(', ')}</div>`));
          body.appendChild(el('h3','post-title',p.title));
          body.appendChild(el('p','post-excerpt',p.excerpt || truncate(stripHtml(p.content),160)));

          const actions = el('div','post-actions');
          const readBtn = el('button','btn','<i class=\"fa-solid fa-book-open\" style=\"margin-right:6px\"></i> Read'); readBtn.addEventListener('click',()=>openPost(p.id)); actions.appendChild(readBtn);

          const user = getCurrentUser();
          if(user && (user.role==='admin' || user.role==='author')){
            const editBtn = el('button','btn ghost','<i class=\"fa-solid fa-pen-to-square\" style=\"margin-right:6px\"></i> Edit'); editBtn.addEventListener('click',()=>editPost(p.id));
            const delBtn = el('button','btn ghost','<i class=\"fa-solid fa-trash\" style=\"margin-right:6px;color:var(--accent-3)\"></i> Delete'); delBtn.addEventListener('click',()=>deletePost(p.id));
            actions.appendChild(editBtn); actions.appendChild(delBtn);
          }

          body.appendChild(actions); card.appendChild(body); postsGrid.appendChild(card);
      })}

      function renderTags(){ if(!tagsList) return; const map=new Map(); POSTS.forEach(p=>p.tags && p.tags.forEach(t=>{const k=t.trim(); if(!k) return; map.set(k,(map.get(k)||0)+1)})); tagsList.innerHTML=''; Array.from(map.entries()).sort((a,b)=>b[1]-a[1]).forEach(([tag,count])=>{ const b = el('button','tag',tag+' ('+count+')'); b.addEventListener('click',()=>filterByTag(tag)); tagsList.appendChild(b); }); }

      function renderFeatured(){ if(!featuredInner) return; featuredInner.innerHTML=''; POSTS.slice(-3).forEach(p=>{ const c = el('div','',`<div style="min-width:220px;border-radius:12px;overflow:hidden;border:1px solid var(--glass);background:var(--card);padding:8px"><img src="${p.image}" style="width:100%;height:120px;object-fit:cover;border-radius:8px" /><div style="padding-top:8px;font-weight:700">${p.title}</div><div style="font-size:13px;color:var(--muted)">${formatDate(p.date)} ‚Ä¢ ${readTime(p.content)}m</div></div>`); featuredInner.appendChild(c); }); }

      function renderPopular(){ if(!popularList) return; popularList.innerHTML=''; POSTS.slice().reverse().slice(0,5).forEach(p=>{ const it = el('div','popular-item',`<div class="popular-thumb"><img src="${p.image}"/></div><div><div style="font-weight:700">${p.title}</div><div style="font-size:13px;color:var(--muted)">${formatDate(p.date)} ‚Ä¢ ${readTime(p.content)}m</div></div>`); it.addEventListener('click',()=>openPost(p.id)); popularList.appendChild(it); }); }

      function deletePost(id){ if(!confirm('Delete this post?')) return; POSTS = POSTS.filter(p=>p.id!==id); save(); renderPosts(); renderTags(); renderFeatured(); renderPopular(); showView('home'); }

      function openPost(id){ const p = POSTS.find(x=>x.id===id); if(!p) return; document.getElementById('homeView').classList.add('hidden'); document.getElementById('editorView').classList.add('hidden'); document.getElementById('readerView').classList.remove('hidden'); const articleInner = document.getElementById('articleInner'); articleInner.innerHTML=''; articleInner.appendChild(el('h1','article-title',p.title)); articleInner.appendChild(el('div','article-meta',`${p.author} ‚Ä¢ ${formatDate(p.date)} ‚Ä¢ ${readTime(p.content)} min read`)); const fig = el('figure',''); const im = el('img',''); im.src=p.image; im.alt=p.title; fig.style.margin='12px 0'; fig.appendChild(im); articleInner.appendChild(fig); articleInner.appendChild(el('div','article-body',p.content)); articleInner.appendChild(el('div','small','Meta: '+(p.meta && p.meta.keywords? p.meta.keywords : ''))); renderPostNav(p.id); window.scrollTo({top:0,behavior:'smooth'});
      }

      function renderPostNav(id){ const idx = POSTS.findIndex(x=>x.id===id); const prev = POSTS[idx+1]||null; const next = POSTS[idx-1]||null; const nav = document.getElementById('postNav'); if(!nav) return; nav.innerHTML=''; const left = el('div','nav-card',''); const right = el('div','nav-card',''); if(prev){left.innerHTML = '<strong>‚Üê '+prev.title+'</strong><div style="color:var(--muted);font-size:13px">'+formatDate(prev.date)+'</div>'; left.onclick=()=>openPost(prev.id)} if(next){right.innerHTML = '<strong>'+next.title+' ‚Üí</strong><div style="color:var(--muted);font-size:13px">'+formatDate(next.date)+'</div>'; right.onclick=()=>openPost(next.id)} nav.appendChild(left); nav.appendChild(right); }

      function showView(v){ state.view=v; const home=document.getElementById('homeView'); const reader=document.getElementById('readerView'); const editorV=document.getElementById('editorView'); if(home) home.classList.toggle('hidden', v!=='home'); if(reader) reader.classList.toggle('hidden', v!=='reader'); if(editorV) editorV.classList.toggle('hidden', v!=='editor'); }
      function filterByTag(tag){ renderPosts(POSTS.filter(p=>p.tags && p.tags.includes(tag))) }

      document.getElementById('searchBtn').addEventListener('click',()=>{ const q=(document.getElementById('searchInput')||{value:''}).value.toLowerCase(); renderPosts(POSTS.filter(p=>p.title.toLowerCase().includes(q) || (p.excerpt||'').toLowerCase().includes(q) || (p.meta && p.meta.keywords && p.meta.keywords.toLowerCase().includes(q)))) });
      document.addEventListener('scroll',()=>{ const doc=document.documentElement; const h = doc.scrollHeight - doc.clientHeight; const pct = (doc.scrollTop/h)*100 || 0; document.getElementById('progress').style.width = pct + '%'; });

      // theme toggle
      const themeToggle = document.getElementById('themeToggle'); let dark=false; function applyTheme(){ if(dark){document.documentElement.classList.add('dark'); themeToggle.innerText='‚òÄÔ∏è'} else {document.documentElement.classList.remove('dark'); themeToggle.innerText='üåô'} }
      applyTheme(); if(themeToggle) themeToggle.addEventListener('click',()=>{ dark=!dark; applyTheme(); });

      // login modal show/hide
      document.getElementById('loginBtn').addEventListener('click',()=>{ if(loginModal){ loginModal.style.display='flex'; loginModal.setAttribute('aria-hidden','false'); } });
      document.getElementById('loginCancel').addEventListener('click',()=>{ if(loginModal){ loginModal.style.display='none'; loginModal.setAttribute('aria-hidden','true'); } });

      document.getElementById('loginConfirm').addEventListener('click',()=>{
        const id = (document.getElementById('loginId')||{value:''}).value.trim();
        const pass = (document.getElementById('loginPass')||{value:''}).value;
        if(!id || !pass){ alert('Provide credentials'); return }
        const acct = ACCOUNTS[id];
        if(!acct || acct.password !== pass){ alert('Invalid demo credentials'); return }
        setCurrentUser({id,role:acct.role});
        if(loginModal){ loginModal.style.display='none'; loginModal.setAttribute('aria-hidden','true'); }
      });

      document.getElementById('logoutBtn').addEventListener('click',()=>{ clearCurrentUser(); });

      // editor toolbar (minimal)
      document.querySelectorAll('.toolbar-btn').forEach(b=>{ b.addEventListener('click',()=>{ const cmd = b.getAttribute('data-cmd'); if(cmd) document.execCommand(cmd,false,null); }); });
      const headingSelect = document.getElementById('headingSelect'); if(headingSelect) headingSelect.addEventListener('change',(e)=>{ const val=e.target.value; document.execCommand('formatBlock',false,val||'p'); e.target.value=''; });

      // image upload via dataURL
      const imageUpload = document.createElement('input'); imageUpload.type='file'; imageUpload.accept='image/*'; imageUpload.style.display='none'; document.body.appendChild(imageUpload);
      document.getElementById('imgBtn').addEventListener('click',()=>imageUpload.click());
      imageUpload.addEventListener('change', async (ev)=>{ const f=ev.target.files[0]; if(!f) return; const data = await new Promise((res,rej)=>{ const r=new FileReader(); r.onload=()=>res(r.result); r.onerror=rej; r.readAsDataURL(f); }); document.execCommand('insertHTML',false,'<img src="'+data+'" alt="uploaded image" style="max-width:100%;border-radius:8px;margin:12px 0" />'); ev.target.value=''; });

      // publish (authors only)
      document.getElementById('publishBtn').addEventListener('click',()=>{
        const user = getCurrentUser(); if(!user || (user.role!=='author' && user.role!=='admin')){ alert('Only signed-in authors can publish posts'); return }
        const title = (document.getElementById('postTitle')||{value:''}).value.trim();
        const content = (document.getElementById('editor')||{innerHTML:''}).innerHTML.trim();
        const keywords = (document.getElementById('metaKeywords')||{value:''}).value.trim();
        const description = (document.getElementById('metaDesc')||{value:''}).value.trim();
        const tags = ((document.getElementById('postTags')||{value:''}).value||'').split(',').map(s=>s.trim()).filter(Boolean);
        const slug = (document.getElementById('postSlug')||{value:''}).value.trim() || title.toLowerCase().replace(/[^a-z0-9 -]/g,'').trim().replace(/ +/g,'-') || ('post-'+Date.now());
        if(!title || !content){ alert('Title and content required'); return }

        if(state.current && state.current.id){ // edit
          if(state.current.author !== user.id && user.role !== 'admin'){ alert('You can only edit your own posts'); return }
          state.current.title = title; state.current.content = content; state.current.excerpt = truncate(stripHtml(content),160); state.current.meta={keywords,description}; state.current.tags = tags; state.current.image = (function(){const m=document.createElement('div');m.innerHTML=content;const i=m.querySelector('img'); return i? i.src : state.current.image})(); state.current.date = new Date().toISOString(); save(); renderPosts(); renderTags(); renderFeatured(); renderPopular(); openPost(state.current.id); return;
        }

        const post = { id: Date.now(), slug, title, excerpt: truncate(stripHtml(content),160), date: new Date().toISOString(), author: user.id || 'You', tags, image:(function(){const m=document.createElement('div');m.innerHTML=content;const i=m.querySelector('img');return i?i.src:''})(), content, meta:{keywords,description} };
        POSTS.push(post); save(); renderPosts(); renderTags(); renderFeatured(); renderPopular(); clearEditor(); openPost(post.id);
      });

      function clearEditor(){ if(document.getElementById('postTitle')) document.getElementById('postTitle').value=''; if(document.getElementById('editor')) document.getElementById('editor').innerHTML=''; if(document.getElementById('metaKeywords')) document.getElementById('metaKeywords').value=''; if(document.getElementById('metaDesc')) document.getElementById('metaDesc').value=''; if(document.getElementById('postTags')) document.getElementById('postTags').value=''; if(document.getElementById('postSlug')) document.getElementById('postSlug').value=''; state.current=null; }

      function editPost(id){ const p = POSTS.find(x=>x.id===id); if(!p) return; const user = getCurrentUser(); if(!user || (user.role!=='author' && user.role!=='admin')){ alert('Only signed-in authors can edit posts'); return } if(user.role!=='admin' && p.author !== user.id){ alert('You can only edit your own posts'); return } document.getElementById('postTitle').value = p.title; document.getElementById('editor').innerHTML = p.content; document.getElementById('metaKeywords').value = p.meta && p.meta.keywords || ''; document.getElementById('metaDesc').value = p.meta && p.meta.description || ''; document.getElementById('postTags').value = p.tags ? p.tags.join(',') : ''; document.getElementById('postSlug').value = p.slug || ''; document.getElementById('homeView').classList.add('hidden'); document.getElementById('readerView').classList.add('hidden'); document.getElementById('editorView').classList.remove('hidden'); state.current = p; }

      // navigation
      document.getElementById('createBtn').addEventListener('click',()=>{ const user = getCurrentUser(); if(!user || (user.role!=='author' && user.role!=='admin')){ if(!confirm('Sign in as author to create posts. Open login?')) return; if(loginModal){ loginModal.style.display='flex'; loginModal.setAttribute('aria-hidden','false'); } return } clearEditor(); document.getElementById('homeView').classList.add('hidden'); document.getElementById('readerView').classList.add('hidden'); document.getElementById('editorView').classList.remove('hidden'); window.scrollTo({top:0}); });
      document.getElementById('ctaBrowse').addEventListener('click',()=>{ document.getElementById('homeView').classList.remove('hidden'); document.getElementById('readerView').classList.add('hidden'); document.getElementById('editorView').classList.add('hidden'); window.scrollTo({top:0}); });

      document.getElementById('searchBtn').addEventListener('click',()=>{ const q=(document.getElementById('searchInput')||{value:''}).value.toLowerCase(); renderPosts(POSTS.filter(p=>p.title.toLowerCase().includes(q) || (p.excerpt||'').toLowerCase().includes(q) || (p.meta && p.meta.keywords && p.meta.keywords.toLowerCase().includes(q)))) });

      // init
      function init(){ renderPosts(); renderTags(); renderFeatured(); renderPopular(); updateUserUI(); showView('home'); }
      init();

      // expose for debug
      window.__MMB = {POSTS,save,renderPosts,renderTags,renderFeatured,renderPopular,getCurrentUser};
    })
  </script>
</body>
</html>
